<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- 顶部标题 -->
    <view class="header">
      <view class="logo">
        <view class="logo-inner"></view>
      </view>
      <text class="title">浓度检测</text>
      <text class="subtitle">PLS 回归模型智能分析</text>
    </view>

    <!-- 图片区域 -->
    <view class="card image-card {{imagePath && !isLoading ? 'has-image' : ''}}" bindtap="chooseImage">
      <!-- 未上传状态 -->
      <view class="upload-area" wx:if="{{!imagePath && !isLoading}}">
        <view class="upload-icon-wrapper">
          <view class="upload-icon">
            <view class="icon-line-h"></view>
            <view class="icon-line-v"></view>
          </view>
        </view>
        <text class="upload-text">点击上传图片</text>
        <text class="upload-hint">支持拍照或从相册选择</text>
      </view>

      <!-- 加载状态 -->
      <view class="loading-area" wx:if="{{isLoading}}">
        <view class="spinner-wrapper">
          <view class="spinner"></view>
        </view>
        <text class="loading-text">智能分析中</text>
        <view class="loading-dots">
          <view class="dot"></view>
          <view class="dot"></view>
          <view class="dot"></view>
        </view>
      </view>

      <!-- 已上传图片展示 -->
      <view class="image-display" wx:if="{{imagePath && !isLoading}}">
        <view class="image-grid">
          <view class="image-item">
            <image class="preview-img" src="{{imagePath}}" mode="aspectFit" catchtap="previewImage" data-src="{{imagePath}}"></image>
            <view class="image-tag">原图</view>
          </view>
          <view class="image-item" wx:if="{{processedImagePath}}">
            <image class="preview-img" src="{{processedImagePath}}" mode="aspectFit" catchtap="previewImage" data-src="{{processedImagePath}}"></image>
            <view class="image-tag highlight">分析区域</view>
          </view>
        </view>
        <view class="tap-hint-btn">重新选择图片</view>
      </view>
    </view>

    <!-- 检测结果 -->
    <view class="card result-card" wx:if="{{concentration}}">
      <view class="result-header">
        <view class="result-icon"></view>
        <text class="result-label">检测浓度</text>
        <view class="type-tag {{colorType}}">{{colorType === 'blue' ? '亚甲基蓝' : '甲基橙'}}</view>
      </view>
      <view class="result-body">
        <text class="result-value">{{concentration}}</text>
      </view>
      <!-- 额外显示吸光度 -->
      <view class="result-extra" wx:if="{{absorbance}}">
        <text class="extra-label">吸光度 (A)</text>
        <text class="extra-value">{{absorbance}}</text>
      </view>
    </view>

    <!-- RGB 信息 -->
    <view class="card rgb-card" wx:if="{{rgbValues}}">
      <view class="rgb-header">
        <text class="section-title">RGB 颜色值</text>
        <view class="color-swatch" style="background:rgb({{rgbRed}},{{rgbGreen}},{{rgbBlue}})"></view>
      </view>
      <view class="rgb-bars">
        <view class="rgb-row">
          <view class="rgb-label-box rgb-label-r">R</view>
          <view class="bar-track">
            <view class="bar-fill bar-r" style="width:{{rgbRed/255*100}}%"></view>
          </view>
          <text class="rgb-num">{{rgbRed}}</text>
        </view>
        <view class="rgb-row">
          <view class="rgb-label-box rgb-label-g">G</view>
          <view class="bar-track">
            <view class="bar-fill bar-g" style="width:{{rgbGreen/255*100}}%"></view>
          </view>
          <text class="rgb-num">{{rgbGreen}}</text>
        </view>
        <view class="rgb-row">
          <view class="rgb-label-box rgb-label-b">B</view>
          <view class="bar-track">
            <view class="bar-fill bar-b" style="width:{{rgbBlue/255*100}}%"></view>
          </view>
          <text class="rgb-num">{{rgbBlue}}</text>
        </view>
      </view>
    </view>

    <!-- 底部提示 -->
    <view class="footer">
      <text>请确保图片包含溶液样本和白色背景区域</text>
    </view>
  </view>
</scroll-view>
